<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Kinetis Bootloader: SPI Slave Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kinetis Bootloader
   &#160;<span id="projectnumber">1.2.0</span>
   </div>
   <div id="projectbrief">Common bootloader for Kinetis devices</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__spi__slave__driver.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a>  </div>
  <div class="headertitle">
<div class="title">SPI Slave Driver<div class="ingroups"><a class="el" href="group__drivers.html">Device Drivers</a> &raquo; <a class="el" href="group__spi.html">SPI</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>SPI slave mode peripheral driver.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for SPI Slave Driver:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><div class="center"><iframe scrolling="no" frameborder="0" src="group__spi__slave__driver.svg" width="216" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structspi__slave__callbacks__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#structspi__slave__callbacks__t">spi_slave_callbacks_t</a></td></tr>
<tr class="memdesc:structspi__slave__callbacks__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">The set of callbacks used for SPI slave mode.  <a href="group__spi__slave__driver.html#structspi__slave__callbacks__t">More...</a><br /></td></tr>
<tr class="separator:structspi__slave__callbacks__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structspi__slave__config__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#structspi__slave__config__t">spi_slave_config_t</a></td></tr>
<tr class="memdesc:structspi__slave__config__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">Definition of application implemented configuration and callback functions used by the SPI slave driver.  <a href="group__spi__slave__driver.html#structspi__slave__config__t">More...</a><br /></td></tr>
<tr class="separator:structspi__slave__config__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
SPI Slave</h2></td></tr>
<tr class="memitem:ga1991d4bbdf1aed9f9d6be4e742457942"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#ga1991d4bbdf1aed9f9d6be4e742457942">spi_slave_init</a> (uint32_t instance, const <a class="el" href="group__spi__slave__driver.html#structspi__slave__config__t">spi_slave_config_t</a> *config)</td></tr>
<tr class="memdesc:ga1991d4bbdf1aed9f9d6be4e742457942"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the SPI module.  <a href="#ga1991d4bbdf1aed9f9d6be4e742457942">More...</a><br /></td></tr>
<tr class="separator:ga1991d4bbdf1aed9f9d6be4e742457942"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae9e868fb56fc15d9ea47e0384e613d58"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#gae9e868fb56fc15d9ea47e0384e613d58">spi_slave_set_data_sink_func</a> (uint32_t instance, void(*data_sink)(uint8_t, uint16_t))</td></tr>
<tr class="memdesc:gae9e868fb56fc15d9ea47e0384e613d58"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the data sink function pointer.  <a href="#gae9e868fb56fc15d9ea47e0384e613d58">More...</a><br /></td></tr>
<tr class="separator:gae9e868fb56fc15d9ea47e0384e613d58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga009505538674a5880e46ba992a61f039"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#ga009505538674a5880e46ba992a61f039">spi_slave_shutdown</a> (uint32_t instance)</td></tr>
<tr class="memdesc:ga009505538674a5880e46ba992a61f039"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deinitializes the device.  <a href="#ga009505538674a5880e46ba992a61f039">More...</a><br /></td></tr>
<tr class="separator:ga009505538674a5880e46ba992a61f039"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Usage Information</h2>
<p>SPI slave mode peripheral driver. </p>


<h3><a class="anchor" id="spislave"></a>SPI Slave Driver</h3><div class="textblock"><h1>Overview</h1>
The SPI slave peripheral driver provides an easy way to use a SPI peripheral in slave mode.Data transfer is performed entirely through a couple callback functions.<h1>Callbacks</h1>
To use this driver, you first need to define a few application callbacks. These are the callbacks functions that are set in the <a class="el" href="group__spi__slave__driver.html#structspi__slave__callbacks__t" title="The set of callbacks used for SPI slave mode. ">spi_slave_callbacks_t</a> struct.The two callbacks are:</p><ul>
<li>Data source</li>
<li>Data sink</li>
</ul>
The two callbacks are for sending and receiving data.The prototypes for the three callbacks are: </p><div class="fragment"><div class="line"><a class="code" href="group__platform__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> dataSource(uint8_t * sourceByte, uint16_t instance);</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__platform__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> dataSink(uint8_t sinkByte, uint16_t instance);</div>
</div><!-- fragment -->All callbacks are invoked from IRQ state.<h1>Setup</h1>
To initialize the SPI slave driver, first create and fill in a <a class="el" href="group__spi__slave__driver.html#structspi__slave__config__t" title="Definition of application implemented configuration and callback functions used by the SPI slave driv...">spi_slave_config_t</a> struct. This struct defines the callbacks as well as the data format settings for the SPI peripheral. The struct is not required after the driver is initialized, so it can be allocated on the stack.Here is an example config struct definition: </p><div class="fragment"><div class="line"><a class="code" href="group__spi__slave__driver.html#structspi__slave__config__t">spi_slave_config_t</a> config = {</div>
<div class="line">        {</div>
<div class="line">            appDataSource,</div>
<div class="line">            appDataSink,</div>
<div class="line">        },</div>
<div class="line">        <a class="code" href="group__spi__types.html#gga9ad313685ade497f5cbcb71c74a1b4dcaac180df70db6fa5463501e6b7a38a183">kSpiClockPhase_FirstEdge</a>,</div>
<div class="line">        <a class="code" href="group__spi__types.html#gga3e5a7cd043c9596779bc23b34cb3d1f9a0b33c8e75da2f2c6a2e821f94cc77f46">kSpiClockPolarity_ActiveHigh</a>,</div>
<div class="line">        <a class="code" href="group__spi__types.html#ggaa68518c16202382c2e1f1c7c66a9d53dad0909dc10154689a11543cc01f4815ad">kSpiLsbFirst</a></div>
<div class="line">    };</div>
</div><!-- fragment --> </div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structspi__slave__callbacks__t" id="structspi__slave__callbacks__t"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct spi_slave_callbacks_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>The set of callbacks used for SPI slave mode. </p>
</div><table class="memberdecls">
<tr><td colspan="2"><h3>Data Fields</h3></td></tr>
<tr class="memitem:aaa7a7392fb3e939d85b80b0628122e2f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaa7a7392fb3e939d85b80b0628122e2f"></a>
void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#aaa7a7392fb3e939d85b80b0628122e2f">dataSource</a> )(uint8_t *sourceByte, uint16_t instance)</td></tr>
<tr class="memdesc:aaa7a7392fb3e939d85b80b0628122e2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback used to get byte to transmit. <br /></td></tr>
<tr class="separator:aaa7a7392fb3e939d85b80b0628122e2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af32813b3009dcad214b33be49b55fe91"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af32813b3009dcad214b33be49b55fe91"></a>
void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#af32813b3009dcad214b33be49b55fe91">dataSink</a> )(uint8_t sinkByte, uint16_t instance)</td></tr>
<tr class="memdesc:af32813b3009dcad214b33be49b55fe91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback used to put received byte. <br /></td></tr>
<tr class="separator:af32813b3009dcad214b33be49b55fe91"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>

</div>
</div>
<a name="structspi__slave__config__t" id="structspi__slave__config__t"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct spi_slave_config_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Definition of application implemented configuration and callback functions used by the SPI slave driver. </p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for spi_slave_config_t:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="structspi__slave__config__t__coll__graph.svg" width="159" height="127"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a8d8a64381ca612c300542da5c416979a"></a><a class="el" href="group__spi__slave__driver.html#structspi__slave__callbacks__t">spi_slave_callbacks_t</a></td>
<td class="fieldname">
callbacks</td>
<td class="fielddoc">
Application callbacks. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ad4eb458a0c1a0c0934eec53d71b78ffb"></a><a class="el" href="group__spi__types.html#gaa68518c16202382c2e1f1c7c66a9d53d">spi_shift_direction_t</a></td>
<td class="fieldname">
direction</td>
<td class="fielddoc">
Either LSB or MSB first. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ac6d76d6b354491d5b43756fdf8ef07d6"></a><a class="el" href="group__spi__types.html#ga9ad313685ade497f5cbcb71c74a1b4dc">spi_clock_phase_t</a></td>
<td class="fieldname">
phase</td>
<td class="fielddoc">
Clock phase setting. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a32c240620581fcb133877d4fbda21226"></a><a class="el" href="group__spi__types.html#ga3e5a7cd043c9596779bc23b34cb3d1f9">spi_clock_polarity_t</a></td>
<td class="fieldname">
polarity</td>
<td class="fielddoc">
Clock polarity setting. </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga1991d4bbdf1aed9f9d6be4e742457942"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_slave_init </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__spi__slave__driver.html#structspi__slave__config__t">spi_slave_config_t</a> *&#160;</td>
          <td class="paramname"><em>config</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the SPI module. </p>
<p>Saves the application callback info, turns on the clock to the module, Enables the device and enables interrupts. Set the SPI to slave mode.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>Instance number of the SPI module. </td></tr>
    <tr><td class="paramname">config</td><td>Pointer to slave mode configuration. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gae9e868fb56fc15d9ea47e0384e613d58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_slave_set_data_sink_func </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(uint8_t, uint16_t)&#160;</td>
          <td class="paramname"><em>data_sink</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the data sink function pointer. </p>
<p>Set the data sink function pointer</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>Instance number of the SPI module. </td></tr>
    <tr><td class="paramname">data_sink</td><td>Pointer to data_sink function. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga009505538674a5880e46ba992a61f039"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_slave_shutdown </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deinitializes the device. </p>
<p>Clears the control register and turns off the clock to the module.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>Instance number of the SPI module. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Jun 3 2015 16:21:26 for Kinetis Bootloader by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
