<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Kinetis Bootloader: DSPI Master Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kinetis Bootloader
   &#160;<span id="projectnumber">1.2.0</span>
   </div>
   <div id="projectbrief">Common bootloader for Kinetis devices</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__dspi__master__driver.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DSPI Master Driver<div class="ingroups"><a class="el" href="group__drivers.html">Device Drivers</a> &raquo; <a class="el" href="group__dspi__driver.html">DSPI</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>DSPI master mode peripheral driver.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for DSPI Master Driver:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><div class="center"><iframe scrolling="no" frameborder="0" src="group__dspi__master__driver.svg" width="243" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</td></tr></table></center>
</div>
<p>DSPI master mode peripheral driver. </p>


<h3><a class="anchor" id="dspimaster"></a>DSPI Master Driver</h3><div class="textblock"><h1>Overview</h1>
The DSPI master mode peripheral driver is used to transfer data to and from external devices on the DSPI bus in master mode. It provides an easy way to transfer buffers of data with a single function call.<h1>Run-time state structs</h1>
The DSPI master driver uses a run-time state struct dspi_master_state_t to keep track of the current data transfer. This struct holds data that are used by the DSPI master peripheral driver to communicate between the transfer function and the interrupt handler. The interrupt handler also uses this information to keep track of its progress. The user is only responsible to pass in the memory for this run-time state structure where the DSPI master driver will take care of filling out the members.<h1>User config structs</h1>
The DSPI master driver uses instances of the user configuration structure dspi_master_user_config_t for the DSPI master driver. This allows you to configure the most common settings of the DSPI peripheral with a single function call.<h1>Device structs</h1>
The DSPI master driver uses instances of the #dspi_device_t structure to represent the SPI bus configuration required to communicate to an external device that is connected to the bus.The device struct can be passed to the data transfer functions, and the bus will be reconfigured before the transfer is started. Alternatively, you can configure the SPI bus for a device manually. For instance, if there is only one device connected to the bus, you might configure it only once.<h1>Initialization</h1>
To initialize the DSPI master driver, simply call dspi_master_init() and pass the instance number of the DSPI peripheral you want to use, the user config of type dspi_master_user_config_t , a pointer to the variable for retrieving the calculated baud rate (this can be a NULL), and memory allocation for the run-time state structure used by the master driver to keep track of data transfers. For instance, to use DSPI1 pass a value of 1 to the init function. The following provides example for the other parameters.Example code for initializing and configuring the driver: </p><div class="fragment"><div class="line"><span class="comment">/* Set up and init the master  */</span></div>
<div class="line">dspi_master_state_t dspiMasterState;</div>
<div class="line">uint32_t calculatedBaudRate;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* configure the members of the user config */</span></div>
<div class="line">dspi_master_user_config_t userConfig;</div>
<div class="line">userConfig.isChipSelectContinuous = <span class="keyword">false</span>;</div>
<div class="line">userConfig.isSckContinuous = <span class="keyword">false</span>;</div>
<div class="line">userConfig.pcsPolarity = <a class="code" href="group__dspi__types.html#ggab466e73cb54b2c023459d43918c4197daf89a174f7da2c2d1dd94eaee5f451ac7">kDspiPcs_ActiveLow</a>;</div>
<div class="line">userConfig.whichCtar = <a class="code" href="group__dspi__types.html#gga992d5562af4cf4c45371feb8c5c1a1bfa21d94da5d7c4e6134907fad358147b35">kDspiCtar0</a>;</div>
<div class="line">userConfig.whichPcs = <a class="code" href="group__dspi__types.html#gga3d9d9a8fe16a51e6c697a547ab65bef1aae6b37fc82d8d2b7425b85dd63172acf">kDspiPcs1</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* init the dspi module */</span></div>
<div class="line">dspi_master_init(masterInstance, &amp;dspiMasterState, &amp;userConfig, &amp;calculatedBaudRate);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Define bus configuration.</span></div>
<div class="line">dspi_device_t spiDevice;</div>
<div class="line">spiDevice.dataBusConfig.bitsPerFrame = 16;</div>
<div class="line">spiDevice.dataBusConfig.clkPhase = <a class="code" href="group__dspi__types.html#gga4269ec144334dd60666a92e6fd2c1476ada723d5970a0b0a28d96a0e707cabd9c">kDspiClockPhase_FirstEdge</a>;</div>
<div class="line">spiDevice.dataBusConfig.clkPolarity = <a class="code" href="group__dspi__types.html#gga1e0a9074742794ef89f597d220296651afffdb6de18c3b46c509c406ac7230586">kDspiClockPolarity_ActiveHigh</a>;</div>
<div class="line">spiDevice.dataBusConfig.direction = <a class="code" href="group__dspi__types.html#gga06fad8ae17b680f6dddfd798c9d3b30daed75ebb641f649ff0c4eb77d2624bcf2">kDspiMsbFirst</a>;</div>
<div class="line">spiDevice.bitsPerSec = 500000;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* configure the spi bus */</span></div>
<div class="line">dspi_master_configure_bus(&amp;dspiMasterState, &amp;spiDevice, &amp;calculatedBaudRate); </div>
</div><!-- fragment --><h1>Transfers</h1>
The driver supports two different modes for transferring data, both blocking and nonblocking (async). The blocking transfer function is dspi_master_transfer() and non-blocking is dspi_master_transfer_async() .Example of a blocking transfer: </p><div class="fragment"><div class="line"><span class="comment">/* Function prototype */</span></div>
<div class="line"><a class="code" href="group__platform__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> dspi_master_transfer(dspi_master_state_t * dspiState,</div>
<div class="line">                              <span class="keyword">const</span> dspi_device_t * restrict device,</div>
<div class="line">                              <span class="keyword">const</span> uint8_t * sendBuffer,</div>
<div class="line">                              uint8_t * receiveBuffer,</div>
<div class="line">                              uint32_t transferByteCount,</div>
<div class="line">                              uint32_t timeout);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Example function call */</span>                              </div>
<div class="line">dspi_master_transfer(&amp;dspiMasterState, NULL, s_dspiSourceBuffer[masterInstance], s_dspiSinkBuffer[masterInstance], 32, 1);</div>
</div><!-- fragment -->Example of a nonblocking transfer: </p><div class="fragment"><div class="line"><span class="comment">/* Function prototype */</span></div>
<div class="line"><a class="code" href="group__platform__status.html#gaaabdaf7ee58ca7269bd4bf24efcde092">status_t</a> dspi_master_transfer_async(dspi_master_state_t * dspiState,</div>
<div class="line">                                    <span class="keyword">const</span> dspi_device_t * restrict device,</div>
<div class="line">                                    <span class="keyword">const</span> uint8_t * sendBuffer,</div>
<div class="line">                                    uint8_t * receiveBuffer,</div>
<div class="line">                                    uint32_t transferByteCount);</div>
<div class="line"><span class="comment">/* Example function call */</span>                              </div>
<div class="line">dspi_master_transfer_async(&amp;dspiMasterState, NULL, s_dspiSourceBuffer[masterInstance], s_dspiSinkBuffer[masterInstance], 32);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* For non-blocking/async transfers, need to check back to get transfer status, for example */</span></div>
<div class="line"><span class="comment">/* Where framesXfer returns the number of frames tranferred */</span></div>
<div class="line">dspi_master_get_transfer_status(&amp;dspiMasterState, &amp;framesXfer);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Jun 3 2015 16:21:26 for Kinetis Bootloader by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
